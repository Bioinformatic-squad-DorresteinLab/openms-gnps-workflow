<?xml version="1.0" encoding="ISO-8859-1"?>
<binding>
	<bind action="begin" type="download">
		<url value="{livesearch.download}"/>
		<query name="task" valueRef="@task"/>
		<query name="user" valueRef="@user"/>
		<compression type="zip"/>

		<download port="flowParams" type="file">
			<query name="resource" value="params"/>
		</download>

		<downloadParams>
			<query name="resource" value="params"/>
		</downloadParams>

		<download port="inputFiles" type="folder">
			<query name="resource" value="inputFiles"/>
		</download>

    <!-- <download port="iniFiles" type="folder">
      <query name="resource" value="iniFiles"/>
    </downlaod> -->

		<download port="iniFiles-featurefinder" type="file">
			<query name="resource" value="iniFiles-featurefinder"/>
		</download>

		<download port="iniFiles-idmapper" type="file">
			<query name="resource" value="iniFiles-idmapper"/>
		</download>

		<download port="iniFiles-mapaligner" type="file">
			<query name="resource" value="iniFiles-mapaligner"/>
		</download>

		<download port="iniFiles-featurelinker" type="file">
			<query name="resource" value="iniFiles-featurelinker"/>
		</download>

		<download port="iniFiles-adductdecharger" type="file">
			<query name="resource" value="iniFiles-adductdecharger"/>
		</download>

		<download port="iniFiles-gnpsexport" type="file">
			<query name="resource" value="iniFiles-gnpsexport"/>
		</download>

		<download port="iniFiles-textexporter" type="file">
			<query name="resource" value="iniFiles-textexporter"/>
		</download>
	</bind>

	<bind action="feature-finder-metabo" tool="feature-finder-metabo">
		<inputAsRequirement port="inputFiles" requirement="inputFiles"/>
		<inputAsRequirement port="iniFiles-featurefinder" requirement="iniFiles-featurefinder"/>

		<productionToOutput port="featurefindermetabo" 		production="featurefindermetabo"/>
	</bind>

  <bind action="id-mapper" tool="id-mapper">
    <inputAsRequirement port="inputFiles" requirement="inputFiles"/>
    <inputAsRequirement port="iniFiles-idmapper"  requirement="iniFiles-idmapper"/>
    <inputAsRequirement port="featurefindermetabo"  requirement="featurefindermetabo"/>

    <productionToOutput port="idmapper" production="idmapper"/>
  </bind>

  <bind action="map-aligner-pose-clustering" tool="map-aligner-pose-clustering">
    <inputAsRequirement port="idmapper" requirement="idmapper"/>
    <inputAsRequirement port="iniFiles-mapaligner"  requirement="iniFiles-mapaligner"/>

    <productionToOutput port="mapalignerposeclustering" production="mapalignerposeclustering"/>
  </bind>

  <bind action="metabolite-adduct-decharger"  tool="metabolite-adduct-decharger">
    <inputAsRequirement port="mapalignerposeclustering" requirement="mapalignerposeclustering"/>
    <inputAsRequirement port="iniFiles-adductdecharger" requirement="iniFiles-adductdecharger"/>

    <productionToOutput port="metaboliteadductdecharger"  production="metaboliteadductdecharger"/>
  </bind>

  <bind action="feature-linker-unlabeled-kd" tool="feature-linker-unlabeled-kd">
    <inputAsRequirement port="metaboliteadductdecharger" requirement="metaboliteadductdecharger"/>
    <inputAsRequirement port="iniFiles-featurelinker"  requirement="iniFiles-featurelinker"/>

    <productionToOutput port="featurelinkerunlabeledkd" production="featurelinkerunlabeledkd"/>
  </bind>

  <bind action="gnps-export"  tool="gnps-export">
    <inputAsRequirement port="featurelinkerunlabeledkd"  requirement="featurelinkerunlabeledkd"/>
    <inputAsRequirement port="inputFiles"           requirement="inputFiles"/>
    <inputAsRequirement port="iniFiles-gnpsexport"  requirement="iniFiles-gnpsexport"/>
    <inputAsRequirement port="flowParams"           requirement="flowParams"/>

    <productionToOutput port="gnpsexport"         production="gnpsexport"/>
  </bind>

  <bind action="gnps-sirius-export"  tool="gnps-sirius-export">
    <inputAsRequirement port="featurelinkerunlabeledkd"  requirement="featurelinkerunlabeledkd"/>
    <inputAsRequirement port="inputFiles"           requirement="inputFiles"/>
    <inputAsRequirement port="iniFiles-gnpsexport"  requirement="iniFiles-gnpsexport"/>
    <inputAsRequirement port="flowParams"           requirement="flowParams"/>

    <productionToOutput port="gnpssiriusexport"         production="gnpssiriusexport"/>
  </bind>

  <bind action="text-exporter"  tool="text-exporter">
    <inputAsRequirement port="featurelinkerunlabeledkd"  requirement="featurelinkerunlabeledkd"/>
    <inputAsRequirement port="iniFiles-textexporter"  requirement="iniFiles-textexporter"/>

    <productionToOutput port="textexporter"         production="textexporter"/>
  </bind>

  <bind action="parse-output"  tool="parse-output">
    <inputAsRequirement port="featurefindermetabo"  requirement="featurefindermetabo"/>
    <inputAsRequirement port="idmapper" requirement="idmapper"/>
    <inputAsRequirement port="mapalignerposeclustering" requirement="mapalignerposeclustering"/>
    <inputAsRequirement port="featurelinkerunlabeledkd" requirement="featurelinkerunlabeledkd"/>
    <inputAsRequirement port="metaboliteadductdecharger"  requirement="metaboliteadductdecharger"/>
    <inputAsRequirement port="gnpsexport"   requirement="gnpsexport"/>
    <inputAsRequirement port="gnpssiriusexport"   requirement="gnpssiriusexport"/>
    <inputAsRequirement port="textexporter" requirement="textexporter"/>

    <productionToOutput port="output" production="output"/>
  </bind>

	<bind action="end" type="upload">
		<url value="{livesearch.upload}"/>
		<query name="task" valueRef="@task"/>
		<contentQuery name="content"/>
		<compression type="zip"/>
		<upload port="output"   type="folder">
			<query name="resource" value="output"/>
		</upload>
	</bind>
</binding>
